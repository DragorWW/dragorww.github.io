const p={LIGHT:"light",DARK:"dark"};function g(o){return o in p?o:p.DARK}(()=>{function o(s){document.querySelectorAll('link[rel="icon"]').forEach(l=>{l.setAttribute("media","none"),l.setAttribute("rel","icon")});const r=document.querySelector(`link[rel="icon"][data-theme="${s}"]`);r&&r.removeAttribute("media")}function t(){const a=g(document.documentElement.getAttribute("data-theme"))===p.LIGHT?p.DARK:p.LIGHT;document.documentElement.setAttribute("data-theme",a),localStorage.setItem("theme",a),o(a)}function n(){const s=g(localStorage.getItem("theme"));document.documentElement.setAttribute("data-theme",s),o(s)}document.addEventListener("DOMContentLoaded",()=>{n()}),window.toggleTheme=t})();(()=>{const o={MAX_FPS:60,MIN_FRAME_TIME:16.666666666666668,FONT_SIZE:30,FONT_FAMILY:"Fira Code, monospace",COLUMN_SPACING:.1,MAX_ACTIVE_COLUMNS_RATIO:5.55,SPAWN_RATE:.5,DESPAWN_RATE:.1,TRAIL_OPACITY:.15,MIN_SCROLL_OPACITY:.2,SYMBOL_UPDATE_RATE:.2},t={COLORS:{OPERATORS:"229, 192, 123",KEYWORDS:"198, 120, 221",FUNCTIONS:"97, 175, 239",STRINGS:"152, 195, 121",COMMENTS:"92, 99, 112",CONSTANTS:"224, 108, 117",BRACKETS:"209, 154, 102"},MIN_OPACITY:.4,MAX_OPACITY:.8,MIN_SPEED:.01,MAX_SPEED:.1},n={OPERATORS:[">=","<=","=>","->","<>","===","!==","||","&&","++","--"],KEYWORDS:["import","export","default","class","const","let","var","function","return","await","async"],FUNCTIONS:["try","catch","finally","break","continue","for","while","if","else","switch","case","do"],STRINGS:["...","?.","::"],COMMENTS:["<!--","-->","/**","*/","//","/*","*/"],CONSTANTS:["=>==","#!/"],BRACKETS:["[]","{}","()","<>","</>"]},s={PIXEL_SIZE:8,MIN_OPACITY:.02,MAX_OPACITY:.15,FADE_SPEED:.001,MAX_PIXELS:300,MOUSE_INFLUENCE_RADIUS:150,MOUSE_REPEL_STRENGTH:1,RETURN_SPEED:.05},a={light:{background:"rgba(255, 255, 255, 1)",pixelColor:"0, 0, 0",minOpacity:.05,maxOpacity:.25},dark:{background:"rgba(17, 17, 17, 1)",pixelColor:"255, 255, 255",minOpacity:.02,maxOpacity:.15}};class r{canvas;ctx;startDelay;mousePosition;currentTheme;isInitialized;pixels;themeObserver;lastTime;measureCanvas;measureCtx;maxCharWidth;columnWidth;columns;drops;activeColumns;opacities;speeds;currentSymbols;symbolUpdateCounters;constructor(e,i=1e3){this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.startDelay=i,this.mousePosition={x:-1e3,y:-1e3},this.currentTheme=document.documentElement.getAttribute("data-theme")||"dark",this.setupCanvas(),this.ctx.fillStyle=a[this.currentTheme].background,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.isInitialized=!1,this.pixels=[],this.setupBackground(),this.bindEvents(),this.themeObserver=new MutationObserver(c=>{c.forEach(m=>{m.attributeName==="data-theme"&&(this.currentTheme=document.documentElement.getAttribute("data-theme")||"dark")})}),this.themeObserver.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]})}initialize(){this.isInitialized||(this.setupMeasureCanvas(),this.initializeArrays(),this.bindEvents(),this.lastTime=0,this.isInitialized=!0)}setupCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}setupMeasureCanvas(){this.measureCanvas=document.createElement("canvas"),this.measureCtx=this.measureCanvas.getContext("2d"),this.measureCtx.font=`${o.FONT_SIZE}px ${o.FONT_FAMILY}`;const e=Object.values(n).flat();this.maxCharWidth=Math.max(...e.map(i=>this.measureCtx.measureText(i).width)),this.columnWidth=this.maxCharWidth+o.FONT_SIZE*o.COLUMN_SPACING}initializeArrays(){this.columns=Math.floor(this.canvas.width/this.columnWidth),this.drops=Array(this.columns).fill(1),this.activeColumns=new Set,this.opacities=Array(this.columns).fill(t.MAX_OPACITY),this.speeds=Array(this.columns).fill(1),this.currentSymbols=new Map,this.symbolUpdateCounters=new Map}bindEvents(){window.addEventListener("resize",()=>this.handleResize()),window.addEventListener("scroll",()=>this.handleScroll()),document.addEventListener("mousemove",e=>{const i=this.canvas.getBoundingClientRect();this.mousePosition={x:e.clientX-i.left,y:e.clientY-i.top+window.scrollY}}),document.addEventListener("mouseleave",()=>{this.mousePosition={x:-1e3,y:-1e3}})}handleResize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.setupBackground();const e=Math.floor(this.canvas.width/this.columnWidth);this.drops.length=e,this.opacities.length=e,this.speeds.length=e,this.drops.fill(1),this.opacities.fill(t.MAX_OPACITY),this.speeds.fill(1),this.activeColumns.clear(),this.currentSymbols.clear(),this.symbolUpdateCounters.clear()}handleScroll(){const e=window.scrollY/(document.documentElement.scrollHeight-window.innerHeight);this.canvas.style.opacity=String(Math.max(o.MIN_SCROLL_OPACITY,1-e))}draw(e){requestAnimationFrame(c=>this.draw(c)),!(e-this.lastTime<o.MIN_FRAME_TIME)&&(this.lastTime=e,this.ctx.fillStyle=a[this.currentTheme].background,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.updatePixels(),this.spawnNewColumns(),this.updateActiveColumns())}isColumnAvailable(e){for(const c of this.activeColumns)if(Math.abs(Number(c)-e.x)<3)return!1;return!0}spawnNewColumns(){if(this.activeColumns.size<this.columns*o.MAX_ACTIVE_COLUMNS_RATIO&&Math.random()>o.SPAWN_RATE){let e=10,i;do i={x:Math.floor(Math.random()*this.columns),chars:[],y:0,speed:0,length:0},e--;while((this.activeColumns.has(i.x)||!this.isColumnAvailable(i))&&e>0);e>0&&!this.activeColumns.has(i.x)&&this.isColumnAvailable(i)&&(this.activeColumns.add(i.x),this.drops[i.x]=1,this.speeds[i.x]=t.MIN_SPEED+Math.random()*(t.MAX_SPEED-t.MIN_SPEED),this.opacities[i.x]=t.MIN_OPACITY+Math.random()*(t.MAX_OPACITY-t.MIN_OPACITY))}}updateActiveColumns(){for(const e of this.activeColumns){if(!this.currentSymbols.has(e)||!this.symbolUpdateCounters.has(e)||Math.random()<o.SYMBOL_UPDATE_RATE){const u=Object.keys(n),d=u[Math.floor(Math.random()*u.length)],y=n[d],C=y[Math.floor(Math.random()*y.length)];this.currentSymbols.set(e,{text:C,category:d}),this.symbolUpdateCounters.set(e,0)}const{text:i,category:c}=this.currentSymbols.get(e),m=e*this.columnWidth+(this.columnWidth-this.measureCtx.measureText(i).width)/2;this.ctx.fillStyle=`rgba(${t.COLORS[c]}, ${this.opacities[e]})`,this.ctx.font=`${o.FONT_SIZE}px ${o.FONT_FAMILY}`,this.ctx.fillText(i,m,this.drops[e]*o.FONT_SIZE),this.symbolUpdateCounters.set(e,(this.symbolUpdateCounters.get(e)||0)+1),this.drops[e]*o.FONT_SIZE>this.canvas.height&&(Math.random()>o.DESPAWN_RATE?(this.activeColumns.delete(e),this.drops[e]=1,this.speeds[e]=1,this.opacities[e]=t.MAX_OPACITY,this.currentSymbols.delete(e),this.symbolUpdateCounters.delete(e)):this.drops[e]=0),this.drops[e]+=this.speeds[e]}}setupBackground(){const e=a[this.currentTheme];this.pixels=Array(s.MAX_PIXELS).fill(null).map(()=>({x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height,originalX:Math.random()*this.canvas.width,originalY:Math.random()*this.canvas.height,size:s.PIXEL_SIZE+Math.random()*s.PIXEL_SIZE*2,opacity:e.minOpacity+Math.random()*(e.maxOpacity-e.minOpacity),fadeDirection:Math.random()>.5?1:-1}))}updatePixels(){const e=a[this.currentTheme];this.pixels.forEach(i=>{if(i.opacity+=s.FADE_SPEED*i.fadeDirection,(i.opacity<=e.minOpacity||i.opacity>=e.maxOpacity)&&(i.fadeDirection*=-1),this.mousePosition){const c=i.x-this.mousePosition.x,m=i.y-this.mousePosition.y,u=Math.sqrt(c*c+m*m);if(u<s.MOUSE_INFLUENCE_RADIUS){const d=(s.MOUSE_INFLUENCE_RADIUS-u)/s.MOUSE_INFLUENCE_RADIUS;i.x+=c/u*d*s.MOUSE_REPEL_STRENGTH,i.y+=m/u*d*s.MOUSE_REPEL_STRENGTH}}i.x+=(i.originalX-i.x)*s.RETURN_SPEED,i.y+=(i.originalY-i.y)*s.RETURN_SPEED,this.ctx.fillStyle=`rgba(${a[this.currentTheme].pixelColor}, ${i.opacity})`,this.ctx.fillRect(i.x,i.y,i.size,i.size)})}start(){setTimeout(()=>{this.initialize(),requestAnimationFrame(e=>this.draw(e))},this.startDelay)}destroy(){this.themeObserver.disconnect()}}((h,e=1e3)=>{const i=new r(h,e);return i.start(),i})("matrix")})();class T{terminal;autoScrollEnabled;savedScrollTop;resizeObserver;constructor(t){this.terminal=t,this.autoScrollEnabled=!0,this.savedScrollTop=0,this.resizeObserver=new ResizeObserver(()=>{this.scrollToBottom()}),this.observeLastPrompt()}observeLastPrompt(){const t=this.terminal.querySelector(".terminal__prompt:last-child");t&&(this.resizeObserver.disconnect(),this.resizeObserver.observe(t))}disableScroll(){this.terminal.style.overflowY="hidden",this.savedScrollTop=this.terminal.scrollTop,this.terminal.addEventListener("scroll",this.preventScroll)}enableScroll(){this.terminal.style.overflowY="auto",this.terminal.removeEventListener("scroll",this.preventScroll)}preventScroll=()=>{this.autoScrollEnabled&&(this.terminal.scrollTop=this.savedScrollTop)};disableAutoScroll(){this.autoScrollEnabled=!1,this.savedScrollTop=this.terminal.scrollTop}enableAutoScroll(){this.autoScrollEnabled=!0}scrollToBottom(){this.autoScrollEnabled&&(this.savedScrollTop=this.terminal.scrollHeight-this.terminal.clientHeight,this.terminal.scrollTop=this.savedScrollTop)}smoothScrollToBottom(){this.autoScrollEnabled&&this.terminal.scrollTo({top:this.terminal.scrollHeight,behavior:"smooth"})}restoreScroll(){this.terminal.scrollTop=this.savedScrollTop}}class v{commandDelay=50;commandPause=1e3;currentDirectory="";currentBranch="";currentInput="";commandHistory=[];historyIndex=-1;hints={ru:["где ты работаешь?","какие проекты делал?","расскажи про опыт работы","как с тобой связаться?","какие технологии используешь?","где тебя найти в соцсетях?","help - список всех команд"],en:["where do you work?","what projects have you done?","tell me about your experience","how can I contact you?","what technologies do you use?","where can I find you on social media?","help - list of all commands"]};hintDelay=1500;typeDelay=60;eraseDelay=30;pauseDelay=1e3;betweenHintsDelay=300;hintIndex=0;hintTimeout=null;isShowingHint=!1;isInitializing=!0;isAnimating=!0;hasAISupport="userAgentData"in navigator&&"speechRecognition"in window;HF_API_TOKEN="hf_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";MODEL_URL="https://api-inference.huggingface.co/models/facebook/blenderbot-400M-distill";container;terminalContent;scrollManager;commands;lang;constructor(t){this.container=document.querySelector(".terminal__history"),this.terminalContent=t,this.scrollManager=new T(this.terminalContent),this.commands={},this.lang=document.documentElement.lang,this.initialize(),this.startHintCycle()}async initialize(){this.loadCommands(),this.scrollManager.disableScroll(),await this.simulateCommand("welcome");const t=["about","skills","projects"];for(const n of t)await this.sleep(this.commandPause),await this.simulateCommand(n);await this.sleep(this.commandPause),this.isAnimating=!1,this.isInitializing=!1,this.scrollManager.enableScroll(),this.setupEventListeners(),this.handlePrompt({showCursor:document.activeElement===this.terminalContent,action:"append"}),setTimeout(()=>{this.currentInput||this.startHintCycle()},1e3)}loadCommands(){const t={};document.querySelectorAll(".terminal__command").forEach(n=>{const s=n.dataset.command;s&&(t[s]={name:s,description:n.dataset.description||"",directory:n.dataset.directory||"",branch:n.dataset.branch||"",command:n.dataset.command||s,execute:()=>n.querySelector("template")?.innerHTML.trim()||""})}),this.commands=t}handlePrompt({command:t="",showCursor:n=!1,action:s="create",isHint:a=!1}={}){const r=n&&(document.activeElement===this.terminalContent||this.isInitializing),l=`
            <span class="terminal__prompt">
                ${this.currentDirectory?`<span class="terminal__prompt-path">${this.currentDirectory}</span>`:""}
                ${this.currentBranch?`<span class="terminal__prompt-branch">(${this.currentBranch})</span>`:""}
                <span class="terminal__prompt-symbol">$</span> 
                <span class="terminal__prompt-input ${a?"hint":""}">${t}${r?'<span class="terminal__prompt-cursor">█</span>':""}</span>
            </span>`;switch(s){case"create":const h=document.createElement("p");return h.innerHTML=l,h;case"update":const e=this.container.lastElementChild;return e.innerHTML=l,a||(this.container.appendChild(e),this.scrollManager.observeLastPrompt(),this.scrollManager.scrollToBottom()),e;case"append":const i=document.createElement("p");return i.innerHTML=l,a||(this.container.appendChild(i),this.scrollManager.observeLastPrompt(),this.scrollManager.scrollToBottom()),i}}sendAnalytics(t,n){typeof gtag=="function"?gtag("event",t,{event_category:"Terminal",...n}):console.debug("Google Analytics not available")}async runCommand(t){if(t.command==="clear"){this.container.innerHTML="";return}const n=t.execute(),s=document.createElement("div");s.innerHTML=n;const a=Array.from(s.children);for(let r=0;r<a.length;r++){const l=a[r],h=document.createElement("div");h.classList.add("terminal__output"),h.appendChild(l),this.container.appendChild(h),this.scrollManager.scrollToBottom(),r<a.length-1&&await this.sleep(500)}t.directory&&(this.currentDirectory=t.directory),t.branch&&(this.currentBranch=t.branch)}async simulateCommand(t){const n=this.commands[t],s=n.command||t;let a=this.handlePrompt({action:"append"}),r="";for(const l of s)await this.sleep(this.commandDelay),r+=l,a.innerHTML=this.handlePrompt({command:r,action:"create"}).innerHTML,this.scrollManager.scrollToBottom();await this.sleep(500),await this.runCommand(n)}async executeCommand(){const t=this.currentInput.trim().toLowerCase();if(t){this.sendAnalytics("terminal_command",{event_label:t,value:1}),this.isAnimating=!0,this.commandHistory.unshift(t),this.historyIndex=-1;const n=this.container.lastElementChild;if(n.innerHTML=this.handlePrompt({command:this.currentInput,action:"update"}).innerHTML,this.commands[t])await this.runCommand(this.commands[t]);else{const s=await this.tryAIResponse(t);if(s){const a=document.createElement("div");a.innerHTML=s,this.container.appendChild(a.firstElementChild),this.scrollManager.scrollToBottom()}}this.isAnimating=!1}this.currentInput="",this.handlePrompt({showCursor:!0,action:"append"}),this.startHintCycle()}async tryAIResponse(t){try{const n=document.getElementById("loading-template"),s=document.createElement("div");s.innerHTML=n.innerHTML;const a=this.container.appendChild(s.firstElementChild);this.scrollManager.scrollToBottom(),await this.sleep(2e3),a&&a.parentNode&&a.parentNode.removeChild(a);const r=await fetch(this.MODEL_URL,{method:"POST",headers:{Authorization:`Bearer ${this.HF_API_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:{text:`Context: You are a helpful assistant for Sergey Andreev's personal website. 
                     He is a CTO with experience in educational projects.
                     Current question: ${t}`,max_length:100}})});if(!r.ok)throw new Error("API Error");const l=await r.json(),h=l.generated_text||l[0].generated_text;return this.sendAnalytics("ai_response",{event_label:t,value:1,response_type:"huggingface",response_text:E(h)}),`<div class="terminal__output terminal__output--ai">
                  <div class="terminal__output-header">🤖 AI Response:</div>
                  <div class="terminal__output-content">${h}</div>
              </div>`}catch(n){console.warn("AI Error:",n);const a=new f().generateResponse(t);return this.sendAnalytics("ai_response",{event_label:t,value:1,response_type:"local",response_text:E(a)}),`<div class="terminal__output terminal__output--ai">
                  <div class="terminal__output-header">🤖 Local AI:</div>
                  <div class="terminal__output-content">${a}</div>
              </div>`}}sleep(t){return new Promise(n=>setTimeout(n,t))}setupEventListeners(){this.terminalContent.addEventListener("click",()=>{this.terminalContent.focus()}),this.terminalContent.setAttribute("tabindex","0"),this.terminalContent.addEventListener("keydown",t=>{t.code==="Space"&&t.preventDefault(),this.handleKeyPress(t)}),this.terminalContent.addEventListener("focus",()=>{this.isShowingHint&&(this.isShowingHint=!1,clearTimeout(this.hintTimeout),this.handlePrompt({command:"",showCursor:!0,action:"update"}))}),this.terminalContent.addEventListener("blur",()=>{!this.currentInput&&!this.isAnimating&&this.startHintCycle()}),document.removeEventListener("keydown",this.handleKeyPress)}handleKeyPress(t){this.isShowingHint&&(this.isShowingHint=!1,clearTimeout(this.hintTimeout),this.currentInput="",this.handlePrompt({command:"",showCursor:!0,action:"update"})),t.key==="Enter"?(this.executeCommand(),this.startHintCycle()):t.key==="Backspace"?(this.currentInput=this.currentInput.slice(0,-1),this.handlePrompt({command:this.currentInput,showCursor:!0,action:"update"})):t.key==="ArrowUp"?this.navigateHistory("up"):t.key==="ArrowDown"?this.navigateHistory("down"):t.key.length===1&&(this.currentInput+=t.key,this.handlePrompt({command:this.currentInput,showCursor:!0,action:"update"}))}navigateHistory(t){this.commandHistory.length!==0&&(this.historyIndex=Math.max(-1,Math.min(this.commandHistory.length-1,this.historyIndex+(t==="down"?1:-1))),this.historyIndex===-1?this.currentInput="":this.currentInput=this.commandHistory[this.historyIndex],this.handlePrompt({command:this.currentInput,showCursor:!0,action:"update"}))}startHintCycle(){!this.currentInput&&!this.isAnimating&&document.activeElement!==this.terminalContent&&(this.hintTimeout=setTimeout(()=>this.showNextHint(),this.hintDelay))}async showNextHint(){if(this.currentInput||this.isAnimating||document.activeElement===this.terminalContent)return;this.isShowingHint=!0;const t=this.hints[this.lang][this.hintIndex];let n="";for(const s of t){if(this.currentInput||!this.isShowingHint||document.activeElement===this.terminalContent)break;n+=s,this.handlePrompt({command:n,showCursor:!0,action:"update",isHint:!0}),await this.sleep(this.typeDelay)}for(!this.currentInput&&this.isShowingHint&&document.activeElement!==this.terminalContent&&await this.sleep(this.pauseDelay);n.length>0&&this.isShowingHint&&!this.currentInput&&document.activeElement!==this.terminalContent;)n=n.slice(0,-1),this.handlePrompt({command:n,showCursor:!0,action:"update",isHint:!0}),await this.sleep(this.eraseDelay);!this.currentInput&&document.activeElement!==this.terminalContent&&(this.hintIndex=(this.hintIndex+1)%this.hints[this.lang].length,await this.sleep(this.betweenHintsDelay),this.startHintCycle()),this.isShowingHint=!1}}class f{keywords;defaultResponses;constructor(){const t=document.documentElement.lang;this.keywords={"опыт|работа|карьера|experience|work|career":[t==="ru"?"Более 10 лет опыта в разработке. Сейчас работаю CTO  Ultimate Education.":"Over 10 years of development experience. Currently working as CTO at Ultimate Education.",t==="ru"?"Руковожу IT-стратегией образовательного холдинга из 7 компаний.":"Leading IT strategy for an educational holding of 7 companies.",t==="ru"?"Специализируюсь на масштабировании образовательных проектов.":"Specializing in scaling educational projects."],"проект|достижени|project|achievement":[t==="ru"?"Разработал LMS систему для 100k+ пользователей.":"Developed LMS system for 100k+ users.",t==="ru"?"Создал комплексную аналитическую платформу для образовательного холдинга.":"Created comprehensive analytics platform for educational holding.",t==="ru"?"Оптимизировал производительность DevOps-системы в 10 раз.":"Optimized DevOps system performance by 10x."],"технолог|стек|язык|tech|stack|language":[t==="ru"?"Основной стек: React, TypeScript, Python, Kubernetes.":"Main stack: React, TypeScript, Python, Kubernetes.",t==="ru"?"Опыт работы с Java, Kotlin, Node.js.":"Experience with Java, Kotlin, Node.js.",t==="ru"?"Активно использую современные облачные технологии.":"Actively using modern cloud technologies."],"образовани|обучени|education|learning":[t==="ru"?"Постоянно развиваюсь в сфере технологий.":"Constantly developing in the technology sphere.",t==="ru"?"Особый интерес к AI и масштабированию систем.":"Special interest in AI and system scaling.",t==="ru"?"Делюсь опытом через менторство и технические статьи.":"Sharing experience through mentoring and technical articles."],"контакт|связ|найти|contact|find|reach":["Email: dragorww@gmail.com","Telegram: @dragorww","GitHub: github.com/dragorww"]},this.defaultResponses=[t==="ru"?"Извините, не совсем понял вопрс. Попробуйте спросить о моем опыте работы, проектах или технологиях.":"Sorry, I didn't quite understand the question. Try asking about my work experience, projects, or technologies.",t==="ru"?"Может быть, вас интересует мой опыт работы в образовательных проектах?":"Perhaps you're interested in my experience with educational projects?",t==="ru"?"Я могу рассказать о технологиях, которые использую, или о своих проектах.":"I can tell you about the technologies I use or about my projects."]}generateResponse(t){const n=t.toLowerCase();for(const[s,a]of Object.entries(this.keywords))if(new RegExp(s,"i").test(n))return a[Math.floor(Math.random()*a.length)];return this.defaultResponses[Math.floor(Math.random()*this.defaultResponses.length)]}}const E=(o,t=500)=>o.length>t?o.substring(0,t)+"...":o;new v(document.querySelector(".terminal__content"));
