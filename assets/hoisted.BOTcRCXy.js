import"./MatrixBackground.astro_astro_type_script_index_0_lang.OhnpFp5b.js";class m{terminal;autoScrollEnabled;savedScrollTop;resizeObserver;constructor(t){this.terminal=t,this.autoScrollEnabled=!0,this.savedScrollTop=0,this.resizeObserver=new ResizeObserver(()=>{this.scrollToBottom()}),this.observeLastPrompt()}observeLastPrompt(){const t=this.terminal.querySelector(".terminal__prompt:last-child");t&&(this.resizeObserver.disconnect(),this.resizeObserver.observe(t))}disableScroll(){this.terminal.style.overflowY="hidden",this.savedScrollTop=this.terminal.scrollTop,this.terminal.addEventListener("scroll",this.preventScroll)}enableScroll(){this.terminal.style.overflowY="auto",this.terminal.removeEventListener("scroll",this.preventScroll)}preventScroll=()=>{this.autoScrollEnabled&&(this.terminal.scrollTop=this.savedScrollTop)};disableAutoScroll(){this.autoScrollEnabled=!1,this.savedScrollTop=this.terminal.scrollTop}enableAutoScroll(){this.autoScrollEnabled=!0}scrollToBottom(){this.autoScrollEnabled&&(this.savedScrollTop=this.terminal.scrollHeight-this.terminal.clientHeight,this.terminal.scrollTop=this.savedScrollTop)}smoothScrollToBottom(){this.autoScrollEnabled&&this.terminal.scrollTo({top:this.terminal.scrollHeight,behavior:"smooth"})}restoreScroll(){this.terminal.scrollTop=this.savedScrollTop}}class u{commandDelay=50;commandPause=1e3;currentDirectory="";currentBranch="";currentInput="";commandHistory=[];historyIndex=-1;hints={ru:["где ты работаешь?","какие проекты делал?","расскажи про опыт работы","как с тобой связаться?","какие технологии используешь?","где тебя найти в соцсетях?","help - список всех команд"],en:["where do you work?","what projects have you done?","tell me about your experience","how can I contact you?","what technologies do you use?","where can I find you on social media?","help - list of all commands"]};hintDelay=1500;typeDelay=60;eraseDelay=30;pauseDelay=1e3;betweenHintsDelay=300;hintIndex=0;hintTimeout=null;isShowingHint=!1;isInitializing=!0;isAnimating=!0;hasAISupport="userAgentData"in navigator&&"speechRecognition"in window;HF_API_TOKEN="hf_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";MODEL_URL="https://api-inference.huggingface.co/models/facebook/blenderbot-400M-distill";container;terminalContent;scrollManager;commands;lang;constructor(t){this.container=document.querySelector(".terminal__history"),this.terminalContent=t,this.scrollManager=new m(this.terminalContent),this.commands={},this.lang=document.documentElement.lang,this.initialize(),this.startHintCycle()}async initialize(){this.loadCommands(),this.scrollManager.disableScroll(),await this.simulateCommand("welcome");const t=["about","skills","projects"];for(const e of t)await this.sleep(this.commandPause),await this.simulateCommand(e);await this.sleep(this.commandPause),this.isAnimating=!1,this.isInitializing=!1,this.scrollManager.enableScroll(),this.setupEventListeners(),this.handlePrompt({showCursor:document.activeElement===this.terminalContent,action:"append"}),setTimeout(()=>{this.currentInput||this.startHintCycle()},1e3)}loadCommands(){const t={};document.querySelectorAll(".terminal__command").forEach(e=>{const i=e.dataset.command;i&&(t[i]={name:i,description:e.dataset.description||"",directory:e.dataset.directory||"",branch:e.dataset.branch||"",command:e.dataset.command||i,execute:()=>e.querySelector("template")?.innerHTML.trim()||""})}),this.commands=t}handlePrompt({command:t="",showCursor:e=!1,action:i="create",isHint:n=!1}={}){const s=e&&(document.activeElement===this.terminalContent||this.isInitializing),r=`
            <span class="terminal__prompt">
                ${this.currentDirectory?`<span class="terminal__prompt-path">${this.currentDirectory}</span>`:""}
                ${this.currentBranch?`<span class="terminal__prompt-branch">(${this.currentBranch})</span>`:""}
                <span class="terminal__prompt-symbol">$</span> 
                <span class="terminal__prompt-input ${n?"hint":""}">${t}${s?'<span class="terminal__prompt-cursor">█</span>':""}</span>
            </span>`;switch(i){case"create":const o=document.createElement("p");return o.innerHTML=r,o;case"update":const l=this.container.lastElementChild;return l.innerHTML=r,n||(this.container.appendChild(l),this.scrollManager.observeLastPrompt(),this.scrollManager.scrollToBottom()),l;case"append":const c=document.createElement("p");return c.innerHTML=r,n||(this.container.appendChild(c),this.scrollManager.observeLastPrompt(),this.scrollManager.scrollToBottom()),c}}sendAnalytics(t,e){typeof gtag=="function"?gtag("event",t,{event_category:"Terminal",...e}):console.debug("Google Analytics not available")}async runCommand(t){if(t.command==="clear"){this.container.innerHTML="";return}const e=t.execute(),i=document.createElement("div");i.innerHTML=e;const n=Array.from(i.children);for(let s=0;s<n.length;s++){const r=n[s],o=document.createElement("div");o.classList.add("terminal__output"),o.appendChild(r),this.container.appendChild(o),this.scrollManager.scrollToBottom(),s<n.length-1&&await this.sleep(500)}t.directory&&(this.currentDirectory=t.directory),t.branch&&(this.currentBranch=t.branch)}async simulateCommand(t){const e=this.commands[t],i=e.command||t;let n=this.handlePrompt({action:"append"}),s="";for(const r of i)await this.sleep(this.commandDelay),s+=r,n.innerHTML=this.handlePrompt({command:s,action:"create"}).innerHTML,this.scrollManager.scrollToBottom();await this.sleep(500),await this.runCommand(e)}async executeCommand(){const t=this.currentInput.trim().toLowerCase();if(t){this.sendAnalytics("terminal_command",{event_label:t,value:1}),this.isAnimating=!0,this.commandHistory.unshift(t),this.historyIndex=-1;const e=this.container.lastElementChild;if(e.innerHTML=this.handlePrompt({command:this.currentInput,action:"update"}).innerHTML,this.commands[t])await this.runCommand(this.commands[t]);else{const i=await this.tryAIResponse(t);if(i){const n=document.createElement("div");n.innerHTML=i,this.container.appendChild(n.firstElementChild),this.scrollManager.scrollToBottom()}}this.isAnimating=!1}this.currentInput="",this.handlePrompt({showCursor:!0,action:"append"}),this.startHintCycle()}async tryAIResponse(t){try{const e=document.getElementById("loading-template"),i=document.createElement("div");i.innerHTML=e.innerHTML;const n=this.container.appendChild(i.firstElementChild);this.scrollManager.scrollToBottom(),await this.sleep(2e3),n&&n.parentNode&&n.parentNode.removeChild(n);const s=await fetch(this.MODEL_URL,{method:"POST",headers:{Authorization:`Bearer ${this.HF_API_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:{text:`Context: You are a helpful assistant for Sergey Andreev's personal website. 
                     He is a CTO with experience in educational projects.
                     Current question: ${t}`,max_length:100}})});if(!s.ok)throw new Error("API Error");const r=await s.json(),o=r.generated_text||r[0].generated_text;return this.sendAnalytics("ai_response",{event_label:t,value:1,response_type:"huggingface",response_text:h(o)}),`<div class="terminal__output terminal__output--ai">
                  <div class="terminal__output-header">🤖 AI Response:</div>
                  <div class="terminal__output-content">${o}</div>
              </div>`}catch(e){console.warn("AI Error:",e);const n=new d().generateResponse(t);return this.sendAnalytics("ai_response",{event_label:t,value:1,response_type:"local",response_text:h(n)}),`<div class="terminal__output terminal__output--ai">
                  <div class="terminal__output-header">🤖 Local AI:</div>
                  <div class="terminal__output-content">${n}</div>
              </div>`}}sleep(t){return new Promise(e=>setTimeout(e,t))}setupEventListeners(){this.terminalContent.addEventListener("click",()=>{this.terminalContent.focus()}),this.terminalContent.setAttribute("tabindex","0"),this.terminalContent.addEventListener("keydown",t=>{t.code==="Space"&&t.preventDefault(),this.handleKeyPress(t)}),this.terminalContent.addEventListener("focus",()=>{this.isShowingHint&&(this.isShowingHint=!1,clearTimeout(this.hintTimeout),this.handlePrompt({command:"",showCursor:!0,action:"update"}))}),this.terminalContent.addEventListener("blur",()=>{!this.currentInput&&!this.isAnimating&&this.startHintCycle()}),document.removeEventListener("keydown",this.handleKeyPress)}handleKeyPress(t){this.isShowingHint&&(this.isShowingHint=!1,clearTimeout(this.hintTimeout),this.currentInput="",this.handlePrompt({command:"",showCursor:!0,action:"update"})),t.key==="Enter"?(this.executeCommand(),this.startHintCycle()):t.key==="Backspace"?(this.currentInput=this.currentInput.slice(0,-1),this.handlePrompt({command:this.currentInput,showCursor:!0,action:"update"})):t.key==="ArrowUp"?this.navigateHistory("up"):t.key==="ArrowDown"?this.navigateHistory("down"):t.key.length===1&&(this.currentInput+=t.key,this.handlePrompt({command:this.currentInput,showCursor:!0,action:"update"}))}navigateHistory(t){this.commandHistory.length!==0&&(this.historyIndex=Math.max(-1,Math.min(this.commandHistory.length-1,this.historyIndex+(t==="down"?1:-1))),this.historyIndex===-1?this.currentInput="":this.currentInput=this.commandHistory[this.historyIndex],this.handlePrompt({command:this.currentInput,showCursor:!0,action:"update"}))}startHintCycle(){!this.currentInput&&!this.isAnimating&&document.activeElement!==this.terminalContent&&(this.hintTimeout=setTimeout(()=>this.showNextHint(),this.hintDelay))}async showNextHint(){if(this.currentInput||this.isAnimating||document.activeElement===this.terminalContent)return;this.isShowingHint=!0;const t=this.hints[this.lang][this.hintIndex];let e="";for(const i of t){if(this.currentInput||!this.isShowingHint||document.activeElement===this.terminalContent)break;e+=i,this.handlePrompt({command:e,showCursor:!0,action:"update",isHint:!0}),await this.sleep(this.typeDelay)}for(!this.currentInput&&this.isShowingHint&&document.activeElement!==this.terminalContent&&await this.sleep(this.pauseDelay);e.length>0&&this.isShowingHint&&!this.currentInput&&document.activeElement!==this.terminalContent;)e=e.slice(0,-1),this.handlePrompt({command:e,showCursor:!0,action:"update",isHint:!0}),await this.sleep(this.eraseDelay);!this.currentInput&&document.activeElement!==this.terminalContent&&(this.hintIndex=(this.hintIndex+1)%this.hints[this.lang].length,await this.sleep(this.betweenHintsDelay),this.startHintCycle()),this.isShowingHint=!1}}class d{keywords;defaultResponses;constructor(){const t=document.documentElement.lang;this.keywords={"опыт|работа|карьера|experience|work|career":[t==="ru"?"Более 10 лет опыта в разработке. Сейчас работаю CTO  Ultimate Education.":"Over 10 years of development experience. Currently working as CTO at Ultimate Education.",t==="ru"?"Руковожу IT-стратегией образовательного холдинга из 7 компаний.":"Leading IT strategy for an educational holding of 7 companies.",t==="ru"?"Специализируюсь на масштабировании образовательных проектов.":"Specializing in scaling educational projects."],"проект|достижени|project|achievement":[t==="ru"?"Разработал LMS систему для 100k+ пользователей.":"Developed LMS system for 100k+ users.",t==="ru"?"Создал комплексную аналитическую платформу для образовательного холдинга.":"Created comprehensive analytics platform for educational holding.",t==="ru"?"Оптимизировал производительность DevOps-системы в 10 раз.":"Optimized DevOps system performance by 10x."],"технолог|стек|язык|tech|stack|language":[t==="ru"?"Основной стек: React, TypeScript, Python, Kubernetes.":"Main stack: React, TypeScript, Python, Kubernetes.",t==="ru"?"Опыт работы с Java, Kotlin, Node.js.":"Experience with Java, Kotlin, Node.js.",t==="ru"?"Активно использую современные облачные технологии.":"Actively using modern cloud technologies."],"образовани|обучени|education|learning":[t==="ru"?"Постоянно развиваюсь в сфере технологий.":"Constantly developing in the technology sphere.",t==="ru"?"Особый интерес к AI и масштабированию систем.":"Special interest in AI and system scaling.",t==="ru"?"Делюсь опытом через менторство и технические статьи.":"Sharing experience through mentoring and technical articles."],"контакт|связ|найти|contact|find|reach":["Email: dragorww@gmail.com","Telegram: @dragorww","GitHub: github.com/dragorww"]},this.defaultResponses=[t==="ru"?"Извините, не совсем понял вопрс. Попробуйте спросить о моем опыте работы, проектах или технологиях.":"Sorry, I didn't quite understand the question. Try asking about my work experience, projects, or technologies.",t==="ru"?"Может быть, вас интересует мой опыт работы в образовательных проектах?":"Perhaps you're interested in my experience with educational projects?",t==="ru"?"Я могу рассказать о технологиях, которые использую, или о своих проектах.":"I can tell you about the technologies I use or about my projects."]}generateResponse(t){const e=t.toLowerCase();for(const[i,n]of Object.entries(this.keywords))if(new RegExp(i,"i").test(e))return n[Math.floor(Math.random()*n.length)];return this.defaultResponses[Math.floor(Math.random()*this.defaultResponses.length)]}}const h=(a,t=500)=>a.length>t?a.substring(0,t)+"...":a;new u(document.querySelector(".terminal__content"));
